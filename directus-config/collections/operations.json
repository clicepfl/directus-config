[
  {
    "_syncId": "07873579-153c-4ea3-b526-7ebf9f49e9c0",
    "flow": "0cd31a50-331b-4cc3-8ce2-fc12ba8634d2",
    "key": "activities",
    "name": "Activities",
    "options": {
      "collection": "icbd_activities_registrations",
      "permissions": "$full",
      "query": {
        "filter": {
          "registration": {
            "_eq": "{{$trigger.key}}"
          }
        }
      }
    },
    "position_x": 37,
    "position_y": 1,
    "reject": null,
    "resolve": "b617ce7c-2697-453e-a765-79b056aa3cea",
    "type": "item-read"
  },
  {
    "_syncId": "42d5ba2f-6e25-4462-b7c8-3512a0c3ea03",
    "flow": "2eb347c0-164e-4a8b-a6f1-e4d66472389b",
    "key": "activities",
    "name": "Activities",
    "options": {
      "collection": "icbd_activities",
      "query": {
        "filter": {
          "id": {
            "_in": "{{$last}}"
          }
        }
      }
    },
    "position_x": 21,
    "position_y": 17,
    "reject": null,
    "resolve": "3bfc667c-ce55-40b2-bc41-b0901c37868e",
    "type": "item-read"
  },
  {
    "_syncId": "f3df25ed-5608-4e22-a903-a9559adec29e",
    "flow": "2eb347c0-164e-4a8b-a6f1-e4d66472389b",
    "key": "activities_populated",
    "name": "Run Script",
    "options": {
      "code": "module.exports = async function (data) {\n  return data.activities.map((a) => {\n    reg = data.activity_registrations.find((r) => r.icbd_activity === a.id);\n    slot = a.timeslots.find((t) => t.start_time === reg.start);\n    trans = data.translations\n      .filter((t) => t.languages_code === \"en-US\")\n      .find((t) => a.translations.indexOf(t.id) !== -1);\n    return { ...a, translation: trans, timeslot: slot };\n  }).sort((a, b) => a.timeslot.start_time.localeCompare(b.timeslot.start_time));\n};\n"
    },
    "position_x": 75,
    "position_y": 17,
    "reject": null,
    "resolve": "c7869efd-7ec8-4503-9dc0-60d7deed331f",
    "type": "exec"
  },
  {
    "_syncId": "aceacd8a-4171-4b73-8177-f2e350ee4a28",
    "flow": "d2ba770b-1958-4b19-bcd3-82193aac3a3d",
    "key": "activity",
    "name": "activity",
    "options": {
      "collection": "icbd_activities",
      "key": [
        "{{activity_registration.icbd_activity}}"
      ],
      "permissions": "$full"
    },
    "position_x": 37,
    "position_y": 1,
    "reject": null,
    "resolve": "eae3c6b3-2654-4581-9515-f328b0dd64d7",
    "type": "item-read"
  },
  {
    "_syncId": "2fcd2999-67f8-42af-915b-f28fc455bda6",
    "flow": "2eb347c0-164e-4a8b-a6f1-e4d66472389b",
    "key": "activity_ids",
    "name": "Activity ids",
    "options": {
      "code": "module.exports = async function(data) {\n\t// Do something...\n\treturn data.activity_registrations.map(e => e.icbd_activity)\n;\n}"
    },
    "position_x": 3,
    "position_y": 17,
    "reject": null,
    "resolve": "42d5ba2f-6e25-4462-b7c8-3512a0c3ea03",
    "type": "exec"
  },
  {
    "_syncId": "012cc5c8-55d4-486f-9c02-10fa4b402636",
    "flow": "d2ba770b-1958-4b19-bcd3-82193aac3a3d",
    "key": "activity_registration",
    "name": "activity_registration",
    "options": {
      "collection": "icbd_activities_registrations",
      "key": [
        "{{$trigger.keys[0]}}"
      ],
      "permissions": "$full"
    },
    "position_x": 19,
    "position_y": 1,
    "reject": null,
    "resolve": "aceacd8a-4171-4b73-8177-f2e350ee4a28",
    "type": "item-read"
  },
  {
    "_syncId": "7c0a05c0-0c90-466c-b0ec-87eda3b064a1",
    "flow": "2eb347c0-164e-4a8b-a6f1-e4d66472389b",
    "key": "activity_registrations",
    "name": "Activity registrations",
    "options": {
      "collection": "icbd_activities_registrations",
      "query": {
        "filter": {
          "registration": {
            "_eq": "{{$trigger.key}}"
          }
        }
      }
    },
    "position_x": 37,
    "position_y": 1,
    "reject": null,
    "resolve": "a6644ff8-a414-41ad-93c3-431a718d904a",
    "type": "item-read"
  },
  {
    "_syncId": "b617ce7c-2697-453e-a765-79b056aa3cea",
    "flow": "0cd31a50-331b-4cc3-8ce2-fc12ba8634d2",
    "key": "can_retrieve_deposit",
    "name": "Can retrieve deposit",
    "options": {
      "code": "module.exports = async function(data) {\n    return data.registration.checked_in && data.activities.every(a => a.attended);\n}"
    },
    "position_x": 55,
    "position_y": 1,
    "reject": null,
    "resolve": "02cffb52-552c-481c-84b3-04373cb05892",
    "type": "exec"
  },
  {
    "_syncId": "bbba8953-cb3c-43bc-a114-72fd721a3bae",
    "flow": "bd181b20-151d-451e-9e1d-8b01bb197fab",
    "key": "can_send",
    "name": "Can send",
    "options": {
      "code": "module.exports = async function(data) {\n\treturn data.event.type === \"faculty_dinner\" && data.registration.payment !== null && !data.registration.confirmation_email_sent;\n}"
    },
    "position_x": 55,
    "position_y": 1,
    "reject": null,
    "resolve": "0bea72b8-f11a-43d3-b8cf-b2a00c6374fc",
    "type": "exec"
  },
  {
    "_syncId": "16e19c57-0c75-430b-b71d-cc48f3683729",
    "flow": "260b7a9d-fe71-4bc6-b54b-0a7ef5c9b8ee",
    "key": "close",
    "name": "close",
    "options": {
      "collection": "events",
      "key": [
        "{{$event.id}}"
      ],
      "payload": {}
    },
    "position_x": 55,
    "position_y": 1,
    "reject": null,
    "resolve": null,
    "type": "item-update"
  },
  {
    "_syncId": "ba29e929-6db1-4983-b034-b651d451b757",
    "flow": "6c94bf7c-3939-4eca-8b5f-e199bd9022c3",
    "key": "condition_326ml",
    "name": "Condition",
    "options": {
      "filter": {
        "event": {
          "type": {
            "_eq": "faculty_dinner"
          }
        }
      }
    },
    "position_x": 37,
    "position_y": 1,
    "reject": null,
    "resolve": "72c448d5-86b7-4f67-9f3c-d4e97426c44a",
    "type": "condition"
  },
  {
    "_syncId": "43edb559-d4f7-4331-aac7-847fe6272097",
    "flow": "2eb347c0-164e-4a8b-a6f1-e4d66472389b",
    "key": "condition_6ep4e",
    "name": "Condition",
    "options": {
      "filter": {
        "_and": [
          {
            "is_complete": {
              "_eq": true
            }
          },
          {
            "event": {
              "type": {
                "_eq": "icbd"
              }
            }
          }
        ]
      }
    },
    "position_x": 91,
    "position_y": 1,
    "reject": null,
    "resolve": "2fcd2999-67f8-42af-915b-f28fc455bda6",
    "type": "condition"
  },
  {
    "_syncId": "b3c777c7-56d3-4601-b4a1-144d5a382927",
    "flow": "9a85d36a-6cde-4a6a-8b35-dbe798226592",
    "key": "condition_hw",
    "name": "Condition",
    "options": {
      "filter": {
        "event": {
          "type": {
            "_eq": "hello_world"
          }
        }
      }
    },
    "position_x": 37,
    "position_y": 1,
    "reject": null,
    "resolve": "3be147d4-852e-40df-a025-775e04cfbc4b",
    "type": "condition"
  },
  {
    "_syncId": "fda9c1c7-0fa5-43b7-848d-5fd773451990",
    "flow": "d1849102-ba01-4a47-bd0c-9bfe125cda3a",
    "key": "condition_nynbu",
    "name": "Condition",
    "options": {
      "filter": {
        "_and": [
          {
            "registration": {
              "registration_email_sent": {
                "_eq": false
              }
            }
          },
          {
            "registration": {
              "registration_complete": {
                "_eq": true
              }
            }
          }
        ]
      }
    },
    "position_x": 37,
    "position_y": 1,
    "reject": null,
    "resolve": "554df351-dad2-42d5-a653-8337504dd386",
    "type": "condition"
  },
  {
    "_syncId": "0bea72b8-f11a-43d3-b8cf-b2a00c6374fc",
    "flow": "bd181b20-151d-451e-9e1d-8b01bb197fab",
    "key": "condition_vgvop",
    "name": "Condition",
    "options": {
      "filter": {
        "can_send": {
          "_eq": true
        }
      }
    },
    "position_x": 3,
    "position_y": 17,
    "reject": null,
    "resolve": "9b2462d9-d673-498c-8328-37323443ef59",
    "type": "condition"
  },
  {
    "_syncId": "e8fe86ed-37e5-4905-b06f-b6a021e3cdcf",
    "flow": "5dabf92a-fba4-44ba-ba31-03d5a55ffc13",
    "key": "condition_vregu",
    "name": "Condition",
    "options": {
      "filter": {
        "event": {
          "type": {
            "_eq": "faculty_dinner"
          }
        }
      }
    },
    "position_x": 21,
    "position_y": 17,
    "reject": null,
    "resolve": "c9b04b3c-72e3-4ec6-83f1-d59197b12813",
    "type": "condition"
  },
  {
    "_syncId": "c9b04b3c-72e3-4ec6-83f1-d59197b12813",
    "flow": "5dabf92a-fba4-44ba-ba31-03d5a55ffc13",
    "key": "count_meals",
    "name": "Count meals",
    "options": {
      "code": "module.exports = async function(data) {\n\treturn data.event.meals.map((meal, idx) => ({...meal, count: data.registrations.filter(o => o.meal == idx).length}))\n}"
    },
    "position_x": 39,
    "position_y": 17,
    "reject": null,
    "resolve": "f7334655-bbc9-4e27-afc4-689a608f6b5d",
    "type": "exec"
  },
  {
    "_syncId": "f3d2384a-deb7-41e7-a38b-acb014163f28",
    "flow": "6cf86bff-9bfb-4707-9166-411d7b60f564",
    "key": "count_vjtqe",
    "name": "Count registrations",
    "options": {
      "code": "module.exports = async function(data) {\n    let count = 0;\n    count += data.registrations.length;\n    \n    for(let i = 0; i < data.registrations.length; i += 1) {\n        if(data.registrations[i].plusOnes) {\n            count += data.registrations[i].plusOnes;\n        }\n    }\n    \n    return {\n        \"registration_count\": count,\n        \"opened\": data.event.opened && !(typeof data.event.max_registrations === \"number\" && data.event.max_registrations <= count),\n    };\n}"
    },
    "position_x": 55,
    "position_y": 1,
    "reject": null,
    "resolve": "3f9cc138-a480-499f-bb1b-223a56807a32",
    "type": "exec"
  },
  {
    "_syncId": "6be2a650-aa3e-424e-a6b3-fed192ffbbb5",
    "flow": "2eb347c0-164e-4a8b-a6f1-e4d66472389b",
    "key": "cv_correction",
    "name": "CV Correction",
    "options": {
      "code": "module.exports = async function(data) {\n\t// Do something...\n\treturn data.activities.some(a => a !== null && a.type === \"cv_correction\");\n}"
    },
    "position_x": 21,
    "position_y": 33,
    "reject": null,
    "resolve": "1035beeb-c9e5-4e9f-939f-49d59f8bb04e",
    "type": "exec"
  },
  {
    "_syncId": "c283ca74-4d4c-49d7-8284-08b1b929cc80",
    "flow": "2eb347c0-164e-4a8b-a6f1-e4d66472389b",
    "key": "cv_correction_template",
    "name": "CV Correction Template",
    "options": {
      "code": "module.exports = async function(data) {\n    return data.cv_correction ? \"\\\"cv_presentation\\\"\" : null;\n}"
    },
    "position_x": 57,
    "position_y": 33,
    "reject": null,
    "resolve": "f8be908b-31a6-40f6-b1ae-bf404b45a5cf",
    "type": "exec"
  },
  {
    "_syncId": "1035beeb-c9e5-4e9f-939f-49d59f8bb04e",
    "flow": "2eb347c0-164e-4a8b-a6f1-e4d66472389b",
    "key": "data",
    "name": "Data",
    "options": {
      "code": "module.exports = async function(data) {\n\t// Do something...\n\treturn data;\n}"
    },
    "position_x": 39,
    "position_y": 33,
    "reject": null,
    "resolve": "c283ca74-4d4c-49d7-8284-08b1b929cc80",
    "type": "exec"
  },
  {
    "_syncId": "a6644ff8-a414-41ad-93c3-431a718d904a",
    "flow": "2eb347c0-164e-4a8b-a6f1-e4d66472389b",
    "key": "event",
    "name": "Event",
    "options": {
      "collection": "events",
      "key": [
        "{{registration.event}}"
      ]
    },
    "position_x": 55,
    "position_y": 1,
    "reject": null,
    "resolve": "1cc5d111-676b-4eca-8ee0-4f3225193dc6",
    "type": "item-read"
  },
  {
    "_syncId": "3e13ec03-942c-406b-9ee3-e40e7456613d",
    "flow": "6cf86bff-9bfb-4707-9166-411d7b60f564",
    "key": "event",
    "name": "Fetch event",
    "options": {
      "collection": "events",
      "key": [
        "{{$trigger.event}}"
      ]
    },
    "position_x": 37,
    "position_y": 1,
    "reject": null,
    "resolve": "f3d2384a-deb7-41e7-a38b-acb014163f28",
    "type": "item-read"
  },
  {
    "_syncId": "d2a6284c-8272-4127-8fd0-c493190c5b96",
    "flow": "5dabf92a-fba4-44ba-ba31-03d5a55ffc13",
    "key": "event",
    "name": "Event",
    "options": {
      "collection": "events",
      "key": [
        "{{registration.event}}"
      ]
    },
    "position_x": 3,
    "position_y": 18,
    "reject": null,
    "resolve": "e8fe86ed-37e5-4905-b06f-b6a021e3cdcf",
    "type": "item-read"
  },
  {
    "_syncId": "332576ae-1ab9-48d8-b084-5e2d3c1f3439",
    "flow": "9a85d36a-6cde-4a6a-8b35-dbe798226592",
    "key": "event",
    "name": "Event",
    "options": {
      "collection": "events",
      "key": [
        "{{$trigger.payload.event}}"
      ]
    },
    "position_x": 19,
    "position_y": 1,
    "reject": null,
    "resolve": "b3c777c7-56d3-4601-b4a1-144d5a382927",
    "type": "item-read"
  },
  {
    "_syncId": "29fcd5a3-d9d1-4eeb-874e-51c83be92009",
    "flow": "6c94bf7c-3939-4eca-8b5f-e199bd9022c3",
    "key": "event",
    "name": "Event",
    "options": {
      "collection": "events",
      "key": [
        "{{$trigger.payload.event}}"
      ]
    },
    "position_x": 19,
    "position_y": 1,
    "reject": null,
    "resolve": "ba29e929-6db1-4983-b034-b651d451b757",
    "type": "item-read"
  },
  {
    "_syncId": "1f5202bf-ff85-4933-ab94-a048ff8895ce",
    "flow": "bd181b20-151d-451e-9e1d-8b01bb197fab",
    "key": "event",
    "name": "Event",
    "options": {
      "collection": "events",
      "key": [
        "{{registration.event}}"
      ]
    },
    "position_x": 37,
    "position_y": 1,
    "reject": null,
    "resolve": "bbba8953-cb3c-43bc-a114-72fd721a3bae",
    "type": "item-read"
  },
  {
    "_syncId": "329b9b4b-19ad-4d5b-9552-98f2b8cdbeb8",
    "flow": "260b7a9d-fe71-4bc6-b54b-0a7ef5c9b8ee",
    "key": "event",
    "name": "event",
    "options": {
      "collection": "events",
      "query": {
        "filter": {
          "event": {
            "_eq": "{{$trigger.id}}"
          }
        }
      }
    },
    "position_x": 19,
    "position_y": 1,
    "reject": null,
    "resolve": "92c6a61c-abb2-4b63-b1ed-eebaa2cb31a1",
    "type": "item-read"
  },
  {
    "_syncId": "0db25e46-81e1-4da6-a2d1-2854cd2335a4",
    "flow": "93c8399e-f2b9-4808-9904-e01dac447ef8",
    "key": "fetch_registration",
    "name": "Fetch registration",
    "options": {
      "collection": "registrations",
      "key": [
        "{{$trigger.keys[0]}}"
      ],
      "query": null
    },
    "position_x": 37,
    "position_y": 1,
    "reject": null,
    "resolve": "b59a03bc-f2d3-457f-8005-406489262071",
    "type": "item-read"
  },
  {
    "_syncId": "1cc5d111-676b-4eca-8ee0-4f3225193dc6",
    "flow": "2eb347c0-164e-4a8b-a6f1-e4d66472389b",
    "key": "is_complete",
    "name": "Is complete",
    "options": {
      "code": "module.exports = async function(data) {\n    return data.registration.payment !== null && !data.registration.confirmation_email_sent && data.activity_registrations.every(a => a.start !== null);\n}"
    },
    "position_x": 73,
    "position_y": 1,
    "reject": null,
    "resolve": "43edb559-d4f7-4331-aac7-847fe6272097",
    "type": "exec"
  },
  {
    "_syncId": "92c6a61c-abb2-4b63-b1ed-eebaa2cb31a1",
    "flow": "260b7a9d-fe71-4bc6-b54b-0a7ef5c9b8ee",
    "key": "is_full",
    "name": "is_full",
    "options": {
      "filter": {
        "event": {
          "max_registrations": {
            "_gte": "{{$event.registration_count}}",
            "_null": false
          }
        }
      }
    },
    "position_x": 37,
    "position_y": 1,
    "reject": null,
    "resolve": "16e19c57-0c75-430b-b71d-cc48f3683729",
    "type": "condition"
  },
  {
    "_syncId": "bdfbef4d-c794-45b2-aafe-ebd0fea0628c",
    "flow": "d2ba770b-1958-4b19-bcd3-82193aac3a3d",
    "key": "is_full",
    "name": "Run Script",
    "options": {
      "code": "module.exports = async function(data) {\n\t// Do something...\n\treturn typeof data.timeslot.max_attendees === \"number\" && data.timeslot.max_attendees <= data.matching_registrations.length;\n}"
    },
    "position_x": 91,
    "position_y": 1,
    "reject": null,
    "resolve": "2e3839c1-06ef-45bb-9243-f7cc9f5f238f",
    "type": "exec"
  },
  {
    "_syncId": "b5a4dae7-26c4-4082-9b5a-838d898adbe3",
    "flow": "93c8399e-f2b9-4808-9904-e01dac447ef8",
    "key": "is_update",
    "name": "Is update",
    "options": {
      "filter": {
        "$trigger": {
          "event": {
            "_eq": "registrations.items.update"
          }
        }
      }
    },
    "position_x": 19,
    "position_y": 1,
    "reject": "e11b9054-6f19-4505-b5eb-e24ca3e01614",
    "resolve": "0db25e46-81e1-4da6-a2d1-2854cd2335a4",
    "type": "condition"
  },
  {
    "_syncId": "cb9c8379-bac4-45f5-8538-cf0b382f13e5",
    "flow": "a9a5e703-de12-4e18-9e71-987bd759ab88",
    "key": "item_read_florn",
    "name": "Read Data",
    "options": {
      "collection": "icbd_activities_registrations",
      "key": [
        "{{$trigger.keys[0]}}"
      ]
    },
    "position_x": 19,
    "position_y": 1,
    "reject": null,
    "resolve": "d35e8f9d-1655-411f-836a-479102a16b5f",
    "type": "item-read"
  },
  {
    "_syncId": "85b9a1b9-1098-4c5c-82cf-28bb03bcf2f8",
    "flow": "d1849102-ba01-4a47-bd0c-9bfe125cda3a",
    "key": "item_update_ez8bv",
    "name": "Update Data",
    "options": {
      "collection": "registrations",
      "key": [
        "{{registration.id}}"
      ],
      "payload": {
        "registration_email_sent": true
      }
    },
    "position_x": 73,
    "position_y": 1,
    "reject": null,
    "resolve": null,
    "type": "item-update"
  },
  {
    "_syncId": "b8986df4-e76d-4399-8354-962414231aa8",
    "flow": "2eb347c0-164e-4a8b-a6f1-e4d66472389b",
    "key": "item_update_fkeir_fxbvb_prbka",
    "name": "Update Data",
    "options": {
      "collection": "registrations",
      "key": [
        "{{registration.id}}"
      ],
      "payload": {
        "confirmation_email_sent": true
      }
    },
    "position_x": 3,
    "position_y": 49,
    "reject": null,
    "resolve": null,
    "type": "item-update"
  },
  {
    "_syncId": "02cffb52-552c-481c-84b3-04373cb05892",
    "flow": "0cd31a50-331b-4cc3-8ce2-fc12ba8634d2",
    "key": "item_update_oylhg",
    "name": "Update Data",
    "options": {
      "collection": "registrations",
      "key": [
        "{{$trigger.key}}"
      ],
      "payload": {
        "can_retreive_deposit": "{{$last}}"
      }
    },
    "position_x": 73,
    "position_y": 1,
    "reject": null,
    "resolve": null,
    "type": "item-update"
  },
  {
    "_syncId": "3192e2b6-5926-418f-81ea-1894a269cf3c",
    "flow": "bd181b20-151d-451e-9e1d-8b01bb197fab",
    "key": "item_update_oz10r",
    "name": "Update Data",
    "options": {
      "collection": "registrations",
      "key": [
        "{{registration.id}}"
      ],
      "payload": {
        "confirmation_email_sent": true
      }
    },
    "position_x": 39,
    "position_y": 17,
    "reject": null,
    "resolve": null,
    "type": "item-update"
  },
  {
    "_syncId": "f7334655-bbc9-4e27-afc4-689a608f6b5d",
    "flow": "5dabf92a-fba4-44ba-ba31-03d5a55ffc13",
    "key": "item_update_qsajm_sbmyv_pnyif",
    "name": "Update Data",
    "options": {
      "collection": "events",
      "key": [],
      "payload": {
        "meals": "{{count_meals}}"
      }
    },
    "position_x": 57,
    "position_y": 17,
    "reject": null,
    "resolve": null,
    "type": "item-update"
  },
  {
    "_syncId": "3f9cc138-a480-499f-bb1b-223a56807a32",
    "flow": "6cf86bff-9bfb-4707-9166-411d7b60f564",
    "key": "item_update_rz4iw_lnanl",
    "name": "Update Data",
    "options": {
      "collection": "events",
      "key": [
        "{{$trigger.event}}"
      ],
      "payload": "{{$last}}",
      "permissions": "$full",
      "query": null
    },
    "position_x": 73,
    "position_y": 1,
    "reject": null,
    "resolve": null,
    "type": "item-update"
  },
  {
    "_syncId": "d51a73f5-79cb-4586-b30b-0fa866dc95b4",
    "flow": "d2ba770b-1958-4b19-bcd3-82193aac3a3d",
    "key": "item_update_wrcj6",
    "name": "Update Data",
    "options": {
      "collection": "icbd_activities",
      "key": [
        "{{activity.id}}"
      ],
      "payload": "{{new_activity}}",
      "permissions": "$full"
    },
    "position_x": 127,
    "position_y": 1,
    "reject": null,
    "resolve": null,
    "type": "item-update"
  },
  {
    "_syncId": "d35e8f9d-1655-411f-836a-479102a16b5f",
    "flow": "a9a5e703-de12-4e18-9e71-987bd759ab88",
    "key": "key",
    "name": "Run Script",
    "options": {
      "code": "module.exports = async function(data) {\n\treturn data[\"$last\"].registration;\n}"
    },
    "position_x": 37,
    "position_y": 1,
    "reject": null,
    "resolve": "7b44409d-7d17-44e9-81f1-65f6b8813a09",
    "type": "exec"
  },
  {
    "_syncId": "6f324f23-5454-4d73-9bb4-fbf9ecc3af7d",
    "flow": "d2ba770b-1958-4b19-bcd3-82193aac3a3d",
    "key": "log_a9wh0",
    "name": "Log to Console",
    "options": {
      "message": "{{$last}}"
    },
    "position_x": 91,
    "position_y": 1,
    "reject": null,
    "resolve": null,
    "type": "log"
  },
  {
    "_syncId": "9b2462d9-d673-498c-8328-37323443ef59",
    "flow": "bd181b20-151d-451e-9e1d-8b01bb197fab",
    "key": "mail_hlcl6",
    "name": "Send Email",
    "options": {
      "data": {
        "event": "{{event}}",
        "qrcode_url": "https://clic.epfl.ch/clicketing/api/qrcode?value={{registration.id}}&size=1024",
        "registration": "{{registration}}"
      },
      "subject": "Confirmation for IC Faculty Dinner",
      "template": "faculty_dinner_confirmation",
      "to": [
        "{{registration.email}}"
      ],
      "type": "template"
    },
    "position_x": 21,
    "position_y": 17,
    "reject": null,
    "resolve": "3192e2b6-5926-418f-81ea-1894a269cf3c",
    "type": "mail"
  },
  {
    "_syncId": "554df351-dad2-42d5-a653-8337504dd386",
    "flow": "d1849102-ba01-4a47-bd0c-9bfe125cda3a",
    "key": "mail_ofzwn",
    "name": "Send Email",
    "options": {
      "data": {
        "registration": "{{registration}}"
      },
      "subject": "Your registration to ICBD",
      "template": "icbd_registration_email",
      "to": [
        "{{registration.email}}"
      ],
      "type": "template"
    },
    "position_x": 55,
    "position_y": 1,
    "reject": null,
    "resolve": "85b9a1b9-1098-4c5c-82cf-28bb03bcf2f8",
    "type": "mail"
  },
  {
    "_syncId": "72c448d5-86b7-4f67-9f3c-d4e97426c44a",
    "flow": "6c94bf7c-3939-4eca-8b5f-e199bd9022c3",
    "key": "mail_ofzwn",
    "name": "Send Email",
    "options": {
      "data": {
        "qrbill_url": "https://clic.epfl.ch/clicketing/api/qrbill?uid={{$trigger.key}}",
        "registration": "{{$trigger.payload}}"
      },
      "subject": "Your registration to IC Faculty Dinner",
      "template": "faculty_dinner_preregistration",
      "to": [
        "{{$trigger.payload.email}}"
      ],
      "type": "template"
    },
    "position_x": 55,
    "position_y": 1,
    "reject": null,
    "resolve": null,
    "type": "mail"
  },
  {
    "_syncId": "54944b7f-3368-4c67-876d-5ffce0cb0376",
    "flow": "d2ba770b-1958-4b19-bcd3-82193aac3a3d",
    "key": "matching_registrations",
    "name": "matching_registrations",
    "options": {
      "collection": "icbd_activities_registrations",
      "permissions": "$full",
      "query": {
        "filter": {
          "_and": [
            {
              "icbd_activity": {
                "_eq": "{{activity.id}}"
              }
            },
            {
              "start": {
                "_eq": "{{timeslot.start_time}}"
              }
            }
          ]
        }
      }
    },
    "position_x": 73,
    "position_y": 1,
    "reject": null,
    "resolve": "bdfbef4d-c794-45b2-aafe-ebd0fea0628c",
    "type": "item-read"
  },
  {
    "_syncId": "2e3839c1-06ef-45bb-9243-f7cc9f5f238f",
    "flow": "d2ba770b-1958-4b19-bcd3-82193aac3a3d",
    "key": "new_activity",
    "name": "new_activity",
    "options": {
      "code": "module.exports = async function(data) {\n    copy = JSON.parse(JSON.stringify(data.activity));\n    \n    copy.timeslots.find(t => t.start_time == data.activity_registration.start).full = data.is_full;\n    \n\treturn copy;\n}"
    },
    "position_x": 109,
    "position_y": 1,
    "reject": null,
    "resolve": "d51a73f5-79cb-4586-b30b-0fa866dc95b4",
    "type": "exec"
  },
  {
    "_syncId": "c7869efd-7ec8-4503-9dc0-60d7deed331f",
    "flow": "2eb347c0-164e-4a8b-a6f1-e4d66472389b",
    "key": "qrcode_url",
    "name": "QRCode URL",
    "options": {
      "code": "module.exports = async function(data) {\n    return `https://clic.epfl.ch/clicketing/api/qrcode?value=${data.registration.id}&size=1024`\n}"
    },
    "position_x": 3,
    "position_y": 33,
    "reject": null,
    "resolve": "6be2a650-aa3e-424e-a6b3-fed192ffbbb5",
    "type": "exec"
  },
  {
    "_syncId": "a1406dcc-8930-4232-a39e-20db4db5b791",
    "flow": "2eb347c0-164e-4a8b-a6f1-e4d66472389b",
    "key": "registration",
    "name": "Registration",
    "options": {
      "collection": "registrations",
      "key": [
        "{{$trigger.key}}"
      ]
    },
    "position_x": 19,
    "position_y": 1,
    "reject": null,
    "resolve": "7c0a05c0-0c90-466c-b0ec-87eda3b064a1",
    "type": "item-read"
  },
  {
    "_syncId": "cae93410-a9e6-4b15-bbd7-40af4b401a77",
    "flow": "d1849102-ba01-4a47-bd0c-9bfe125cda3a",
    "key": "registration",
    "name": "registration",
    "options": {
      "collection": "registrations",
      "key": [
        "{{$trigger.keys[0]}}"
      ]
    },
    "position_x": 19,
    "position_y": 1,
    "reject": null,
    "resolve": "fda9c1c7-0fa5-43b7-848d-5fd773451990",
    "type": "item-read"
  },
  {
    "_syncId": "a7970442-4d7e-4708-a10b-d5c7fbf0c6e3",
    "flow": "0cd31a50-331b-4cc3-8ce2-fc12ba8634d2",
    "key": "registration",
    "name": "Registration",
    "options": {
      "collection": "registrations",
      "key": [
        "{{$trigger.key}}"
      ],
      "permissions": ""
    },
    "position_x": 19,
    "position_y": 1,
    "reject": null,
    "resolve": "07873579-153c-4ea3-b526-7ebf9f49e9c0",
    "type": "item-read"
  },
  {
    "_syncId": "c3dfdeab-d32c-4098-94c8-27fd8bc1c207",
    "flow": "5dabf92a-fba4-44ba-ba31-03d5a55ffc13",
    "key": "registration",
    "name": "Registration",
    "options": {
      "collection": "registrations",
      "key": [
        "{{registration_key}}"
      ],
      "query": null
    },
    "position_x": 37,
    "position_y": 1,
    "reject": null,
    "resolve": "c7f98aca-73cc-4f28-9cb1-084167f2c2c9",
    "type": "item-read"
  },
  {
    "_syncId": "35355e6f-a3ba-4164-8c27-0377467e4073",
    "flow": "bd181b20-151d-451e-9e1d-8b01bb197fab",
    "key": "registration",
    "name": "Registration",
    "options": {
      "collection": "registrations",
      "key": [
        "{{$trigger.keys[0]}}"
      ]
    },
    "position_x": 19,
    "position_y": 1,
    "reject": null,
    "resolve": "1f5202bf-ff85-4933-ab94-a048ff8895ce",
    "type": "item-read"
  },
  {
    "_syncId": "0f2f6646-d4e3-4729-95ad-9bfd6412ff29",
    "flow": "5dabf92a-fba4-44ba-ba31-03d5a55ffc13",
    "key": "registration_key",
    "name": "Registration key",
    "options": {
      "code": "module.exports = async function(data) {\n\treturn data[\"$trigger\"].key || data[\"$trigger\"].keys[0];\n}"
    },
    "position_x": 19,
    "position_y": 1,
    "reject": null,
    "resolve": "c3dfdeab-d32c-4098-94c8-27fd8bc1c207",
    "type": "exec"
  },
  {
    "_syncId": "c7f98aca-73cc-4f28-9cb1-084167f2c2c9",
    "flow": "5dabf92a-fba4-44ba-ba31-03d5a55ffc13",
    "key": "registrations",
    "name": "Registrations",
    "options": {
      "collection": "registrations",
      "query": {
        "filter": {
          "event": {
            "_eq": "{{registration.event}}"
          }
        }
      }
    },
    "position_x": 55,
    "position_y": 1,
    "reject": null,
    "resolve": "d2a6284c-8272-4127-8fd0-c493190c5b96",
    "type": "item-read"
  },
  {
    "_syncId": "f90adf41-fc9c-49b7-a5c8-1ca2a7b0ccaf",
    "flow": "6cf86bff-9bfb-4707-9166-411d7b60f564",
    "key": "registrations",
    "name": "Fetch registrations",
    "options": {
      "collection": "registrations",
      "query": {
        "filter": {
          "event": {
            "_eq": "{{$trigger.event}}"
          }
        }
      }
    },
    "position_x": 19,
    "position_y": 1,
    "reject": null,
    "resolve": "3e13ec03-942c-406b-9ee3-e40e7456613d",
    "type": "item-read"
  },
  {
    "_syncId": "f8be908b-31a6-40f6-b1ae-bf404b45a5cf",
    "flow": "2eb347c0-164e-4a8b-a6f1-e4d66472389b",
    "key": "request_mbi47",
    "name": "Webhook / Request URL",
    "options": {
      "body": "{\n  \"template_name\": \"icbd_confirmation\",\n  \"ics_name\": {{ cv_correction_template }},\n  \"email_address\": \"{{ registration.email }}\",\n  \"subject\": \"ICBD registration confirmation\",\n  \"parameters\": {{ data }}\n}",
      "headers": [
        {
          "header": "Content-Type",
          "value": "application/json"
        }
      ],
      "method": "POST",
      "url": "https://clic.epfl.ch/mail-sender/send?secret=74dc0c2810fc14a65c571bc38e3d6fe63d9a41c9"
    },
    "position_x": 75,
    "position_y": 33,
    "reject": null,
    "resolve": "b8986df4-e76d-4399-8354-962414231aa8",
    "type": "request"
  },
  {
    "_syncId": "3be147d4-852e-40df-a025-775e04cfbc4b",
    "flow": "9a85d36a-6cde-4a6a-8b35-dbe798226592",
    "key": "send_email_kxure",
    "name": "Send Email",
    "options": {
      "data": {
        "event": "{{event}}",
        "qrcode_url": "https://clic.epfl.ch/clicketing/api/qrcode?value={{$trigger.key}}&size=1024",
        "registration": "{{$trigger.payload}}"
      },
      "subject": "Registration Confirmation for Hello World",
      "template": "hello_world_confirmation",
      "to": [
        "{{$trigger.payload.email}}"
      ],
      "type": "template"
    },
    "position_x": 55,
    "position_y": 1,
    "reject": null,
    "resolve": "0a5caf39-4b92-40dd-b57f-97c5af62780f",
    "type": "mail"
  },
  {
    "_syncId": "eae3c6b3-2654-4581-9515-f328b0dd64d7",
    "flow": "d2ba770b-1958-4b19-bcd3-82193aac3a3d",
    "key": "timeslot",
    "name": "timeslot",
    "options": {
      "code": "module.exports = async function(data) {\n\treturn data.activity.timeslots.find(t => t.start_time == data.activity_registration.start);\n}"
    },
    "position_x": 55,
    "position_y": 1,
    "reject": null,
    "resolve": "54944b7f-3368-4c67-876d-5ffce0cb0376",
    "type": "exec"
  },
  {
    "_syncId": "02825af7-5366-4d7e-ade8-0d268231fae0",
    "flow": "2eb347c0-164e-4a8b-a6f1-e4d66472389b",
    "key": "translations",
    "name": "translations",
    "options": {
      "collection": "icbd_activities_translations",
      "query": {
        "filter": {
          "id": {
            "_in": "{{$last}}"
          }
        }
      }
    },
    "position_x": 57,
    "position_y": 17,
    "reject": null,
    "resolve": "f3df25ed-5608-4e22-a903-a9559adec29e",
    "type": "item-read"
  },
  {
    "_syncId": "3bfc667c-ce55-40b2-bc41-b0901c37868e",
    "flow": "2eb347c0-164e-4a8b-a6f1-e4d66472389b",
    "key": "translations_id",
    "name": "Translations id",
    "options": {
      "code": "module.exports = async function(data) {\n\t// Do something...\n\treturn data.activities.map(a => a.translations).flat();\n}"
    },
    "position_x": 39,
    "position_y": 17,
    "reject": null,
    "resolve": "02825af7-5366-4d7e-ade8-0d268231fae0",
    "type": "exec"
  },
  {
    "_syncId": "c10505e7-8d6c-44d6-90c1-3e3c725694aa",
    "flow": "ad0d9b41-7409-414d-aa77-1baf45565dbd",
    "key": "trigger_90arx",
    "name": "Trigger Flow",
    "options": {
      "flow": "0cd31a50-331b-4cc3-8ce2-fc12ba8634d2",
      "payload": {
        "key": "{{$trigger.keys[0]}}"
      }
    },
    "position_x": 37,
    "position_y": 1,
    "reject": null,
    "resolve": null,
    "type": "trigger"
  },
  {
    "_syncId": "476d6f96-2441-4698-8128-2c1df9610b5d",
    "flow": "a9a5e703-de12-4e18-9e71-987bd759ab88",
    "key": "trigger_ehyqh",
    "name": "Trigger Flow",
    "options": {
      "flow": "0cd31a50-331b-4cc3-8ce2-fc12ba8634d2",
      "payload": {
        "key": "{{key}}"
      }
    },
    "position_x": 73,
    "position_y": 1,
    "reject": null,
    "resolve": null,
    "type": "trigger"
  },
  {
    "_syncId": "efe96730-8c6d-4500-9afc-3cf8fce09e87",
    "flow": "ad0d9b41-7409-414d-aa77-1baf45565dbd",
    "key": "trigger_js0o2",
    "name": "Trigger Flow",
    "options": {
      "flow": "2eb347c0-164e-4a8b-a6f1-e4d66472389b",
      "payload": {
        "key": "{{$trigger.keys[0]}}"
      }
    },
    "position_x": 19,
    "position_y": 1,
    "reject": null,
    "resolve": "c10505e7-8d6c-44d6-90c1-3e3c725694aa",
    "type": "trigger"
  },
  {
    "_syncId": "b59a03bc-f2d3-457f-8005-406489262071",
    "flow": "93c8399e-f2b9-4808-9904-e01dac447ef8",
    "key": "trigger_o9drl",
    "name": "Trigger Flow",
    "options": {
      "flow": "6cf86bff-9bfb-4707-9166-411d7b60f564",
      "payload": "{{$last}}"
    },
    "position_x": 55,
    "position_y": 1,
    "reject": null,
    "resolve": null,
    "type": "trigger"
  },
  {
    "_syncId": "e11b9054-6f19-4505-b5eb-e24ca3e01614",
    "flow": "93c8399e-f2b9-4808-9904-e01dac447ef8",
    "key": "trigger_o9drl_bjfdv",
    "name": "Trigger Flow",
    "options": {
      "flow": "6cf86bff-9bfb-4707-9166-411d7b60f564",
      "payload": "{{$trigger.payload}}"
    },
    "position_x": 37,
    "position_y": 16,
    "reject": null,
    "resolve": null,
    "type": "trigger"
  },
  {
    "_syncId": "7b44409d-7d17-44e9-81f1-65f6b8813a09",
    "flow": "a9a5e703-de12-4e18-9e71-987bd759ab88",
    "key": "trigger_rmf4o",
    "name": "Trigger Flow",
    "options": {
      "flow": "2eb347c0-164e-4a8b-a6f1-e4d66472389b",
      "payload": {
        "key": "{{key}}"
      }
    },
    "position_x": 55,
    "position_y": 1,
    "reject": null,
    "resolve": "476d6f96-2441-4698-8128-2c1df9610b5d",
    "type": "trigger"
  },
  {
    "_syncId": "0a5caf39-4b92-40dd-b57f-97c5af62780f",
    "flow": "9a85d36a-6cde-4a6a-8b35-dbe798226592",
    "key": "update_data_wwpfl",
    "name": "Update Data",
    "options": {
      "collection": "registrations",
      "key": [
        "{{$trigger.key}}"
      ],
      "payload": {
        "confirmation_email_sent": true
      }
    },
    "position_x": 73,
    "position_y": 1,
    "reject": null,
    "resolve": null,
    "type": "item-update"
  }
]
